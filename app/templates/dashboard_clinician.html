{% extends "base.html" %}
{% block content %}

<div class="dash-header">
    <div>
        <div class="page-title">Dashboard</div>
    </div>

    <a href="/clinician/new-patient" class="btn-primary">
        ADD NEW PATIENT
    </a>
</div>

<div class="divider"></div>


<!-- ===================== -->
<!-- PATIENT LIST -->
<!-- ===================== -->
<div class="panel">
    <div class="panel-head flex-between">
        <span>PATIENT LIST</span>
        <span class="record-count">{{ total_patients }} RECORDS</span>
    </div>

    <div class="panel-body">
        <table class="clinical-table">
            <thead>
                <tr>
                    <th>PATIENT NAME</th>
                    <th>NATIONAL ID</th>
                    <th>LAST VISIT</th>
                    <th>RISK LEVEL</th>
                    <th>ACTIONS</th>
                </tr>
            </thead>
            <tbody>
            {% for p in patients %}
                <tr>
                    <td>{{ p.full_name }}</td>
                    <td>{{ p.national_id }}</td>

                    <!-- LAST VISIT -->
                    <td>
                        {% if p.last_visit %}
                            {{ p.last_visit.created_at.strftime("%Y-%m-%d") }}
                        {% else %}
                            -
                        {% endif %}
                    </td>

                    <!-- RISK LEVEL -->
                    <td>
                        {% if p.last_visit %}
                            <span class="risk-badge {{ p.last_visit.risk_level|lower }}">
                                {{ p.last_visit.risk_level }}
                            </span>
                        {% else %}
                            <span class="risk-badge na">N/A</span>
                        {% endif %}
                    </td>

                    <!-- ACTIONS -->
                    <td class="table-actions">

                        {% if p.last_visit %}
                            <a href="/clinician/result/{{ p.last_visit.id }}" class="action-btn">
                                VIEW
                            </a>
                        {% endif %}

                        <a href="/clinician/new-patient?step=b&patient_id={{ p.id }}" class="action-btn">
                            NEW VISIT
                        </a>

                    </td>
                </tr>
            {% else %}
                <tr>
                    <td colspan="5" class="empty-row">
                        No patients yet.
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</div>


<!-- ===================== -->
<!-- SUMMARY -->
<!-- ===================== -->
<div class="panel">
    <div class="panel-head">SUMMARY STATISTICS</div>
    <div class="panel-body">
        <div class="summary-grid">

            <div class="summary-box">
                <div class="summary-num">{{ total_patients }}</div>
                <div class="summary-label">TOTAL PATIENTS</div>
            </div>

            <div class="summary-box">
                <div class="summary-num">{{ high_count }}</div>
                <div class="summary-label">HIGH RISK</div>
            </div>

            <div class="summary-box">
                <div class="summary-num">{{ low_count }}</div>
                <div class="summary-label">LOW / MODERATE RISK</div>
            </div>

        </div>
    </div>
</div>

{% endblock %}